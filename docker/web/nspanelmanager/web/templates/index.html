{% extends 'base.html' %}

{% block head %}
{% load static %}
<script src="{% static 'index.js' %}"></script>
{% endblock %}

{% block content %}
<h2 class="title is-4">Panels</h2>
<table class="table is-fullwidth is-hoverable">
    <thead>
        <tr>
            <th>NSPanel</th>
            <th>Room</th>
            <th>IP Address</th>
            <th>Status</th>
            <th><i class="fa-solid fa-solid fa-wifi" title="WiFi signal strength"></i></th>
            <th><i class="fa-solid fa-memory" title="Memory used"></i></th>
            <th>Version</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for nspanel in nspanels %}
        <tr>
            <th><a href="{% url 'edit_nspanel' panel_id=nspanel.id %}">{{ nspanel.friendly_name }}</a></th>
            <td><a href="{% url 'edit_room' room_id=nspanel.room.id %}">{{ nspanel.room.friendly_name }}</a>
            </td>
            <td>
                <a href="http://{{ nspanel.ip_address }}" target="_blank">{{ nspanel.ip_address }}</a>
            </td>
            <td>
                {% if nspanel.online_state %}
                <span class="tag is-success">Online</span>
                {% else %}
                <span class="tag is-danger">Offline</span>
                {% endif %}
            </td>
            <td>
                {% if nspanel.status_data.rssi < 90 %}
                <i class="fa-solid fa-wifi-weak" title="{{ nspanel.status_data.rssi }} dBm"></i>
                {% elif nspanel.state_data.rssi < 67 %}
                <i class="fa-solid fa-wifi-fair" title="{{ nspanel.status_data.rssi }} dBm"></i>
                {% else  %}
                <i class="fa-solid fa-wifi" title="{{ nspanel.status_data.rssi }} dBm"></i>
                {% endif %}
            </td>
            <td>{{ nspanel.status_data.heap_used_pct }}%</td>
            <td>{{ nspanel.version }}</td>
            <td>
                <a type="button" class="button is-primary is-small" href="/api/reboot_panel?address={{ nspanel.ip_address }}">Reboot</a>
                <button type="button" class="button is-link is-small" onclick="startNSPanelOtaUpdate('{{ nspanel.ip_address }}');">OTA Update</button>
                <button type="button" class="button is-link is-small" onclick="startNSPanelTftUpdate('{{ nspanel.ip_address }}');">TFT Update</button>
                <a href="{% url 'delete_nspanel' panel_id=nspanel.id %}" type="button" class="button is-danger is-small" >Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}