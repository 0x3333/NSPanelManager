{% extends 'base.html' %}

{% block head %}
{% load static %}
  <script src="{% static 'question.js' %}?refresh={% now 'U' %}"></script>
  <script>
    $(document).ready(() => {
      var types = {
        "home_assistant_type_filter": JSON.stringify([
          "weather"
        ])
      };
      $.get("/api/get_all_available_entities", types, function (data) {
        data.home_assistant_entities.forEach((entity) => {
          $("#weather_entity").append($('<option>', {
            value: "homeassistant," + entity.entity_id,
            text: entity.label
          }));
        });

        data.openhab_entities.forEach((entity) => {
          $("#weather_entity").append($('<option>', {
            value: "openhab," + entity.entity_id,
            text: entity.label
          }));
        });
        data.manual_entities.forEach((entity) => {
          $("#weather_entity").append($('<option>', {
            value: "manual," + entity.entity_id,
            text: entity.label
          }));
        });

        $("#weather_entity").val("{{ weather_entity }}").change();
      });
    });
  </script>
{% endblock %}

{% block content %}

{% load mathfilters %}
<div class="level">
  <div class="level-left">
    <div class="level-item">
      <h2 class="title is-4">Weather & Time</h2>
    </div>
  </div>
</div>
<div>
  <form method="POST" action="{% url 'weather_and_time' %}">
    {% csrf_token %}
    <div class="box">
      <div class="field">
        <label class="label">Date format<span class="question">
          <span class="icon question_icon">
            <i class="mdi mdi-information has-text-info"></i>
          </span>
          <div class="question_help_text notification is-info is-light">
            The format of the date on the NSPanel. This is set using the strftime function. See available formatting for all options.
          </div>
        </label>
        <div class="control">
          <input class="input" type="text" name="date_format" id="date_format"
              placeholder="strftime format" value="{{ date_format }}">
        </div>
        <div class="control mt-2">
          <a href="https://cplusplus.com/reference/ctime/strftime/" target="_blank" class="button is-link">See available formatting</a>
        </div>
      </div>

      <div class="field">
        <label class="label">Weather entity<span class="question">
          <span class="icon question_icon">
            <i class="mdi mdi-information has-text-info"></i>
          </span>
          <div class="question_help_text notification is-info is-light">
            The entity you wish to use for the weather information on the screensaver.
          </div>
        </label>
        <div class="control">
            <div class="select">
              <select name="weather_entity" id="weather_entity">
                <option value="">- Do not use weather -</option>
              </select>
            </div>
        </div>
      </div>

      <div class="field">
      <label class="checkbox">
          {% if clock_us_style == "True" %}
              <input type="checkbox" name="clock_us_style" checked>
          {% else %}
              <input type="checkbox" name="clock_us_style">
          {% endif %}
          Show the time with AM/PM
          <span class="question">
            <span class="icon question_icon">
              <i class="mdi mdi-information has-text-info"></i>
            </span>
            <div class="question_help_text notification is-info is-light">
              Wether or not to use 24 or 12 hour clock. Enabling this will show the clock with AM and PM.
            </div>
          </span>
      </label>
      </div>
      <div class="field">
        <label class="checkbox">
            {% if use_farenheit == "True" %}
                <input type="checkbox" name="use_farenheit" checked>
            {% else %}
                <input type="checkbox" name="use_farenheit">
            {% endif %}
            Use farenheit
            <span class="question">
              <span class="icon question_icon">
                <i class="mdi mdi-information has-text-info"></i>
              </span>
              <div class="question_help_text notification is-info is-light">
                Wether to report temperature in farenheit. Default: Unchecked = report in celcius.
              </div>
            </span>
        </label>
      </div>
    </div>

    <!-- Add 1rem of padding to bottom to prevent a white bar appering on the bottom of the page -->
    <div class="level mt-4" style="padding-bottom: 1rem;">
      <div class="level-left">
        <div class="buttons is-right">
        </div>
      </div>
      <div class="level-right">
        <div class="buttons">
          <button class="button is-success" type="submit" id="save_button">Save</button>
        </div>
      </div>
    </div>
  </form>
</div>
{% endblock %}
